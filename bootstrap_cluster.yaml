- hosts:  admins
  become: "{{ root_user }}"
  tasks:
       - name: Perform a Registry Login on the bootstrap node
         cephadm_registry_login:
             state: login
             registry_url: "{{ registry_url }}"
             registry_username: "{{ registry_username }}"
             registry_password: "{{ registry_pass }}"
         when: use_registry_auth | bool


       - name: Check the node is already bootstrapped or not
         ansible.builtin.shell:
                 cmd: netstat -tnlp | grep 3300 | wc -l
         register: bootstrap_status


       - name: Print Output
         ansible.builtin.debug:
                 msg: "{{ bootstrap_status.stdout | int }}"

                 
       - name: Boostrap the cluster 
         cephadm_bootstrap:
             mon_ip: "{{ ansible_facts['all_ipv4_addresses'] | ansible.utils.ipaddr('10.74.253.45/21') | join() }}"
             image: "{{ cluster_image }}"
             monitoring: "{{ use_monitoring }}"
             cluster_network: "{{ cluster_network }}"
         when: ( bootstrap_status.stdout | int < 1 )

       - name: Get the cluster status & version
         ansible.builtin.shell:
                 cmd: "ceph versions && ceph status"
         register: out

       - name: Print the cluster status and version
         ansible.builtin.debug:
                 msg: "{{ out.stdout }}"


